# 分组调度策略说明

## 调度策略工作原理

### 基本规则
1. **优先级优先**：总是优先选择高优先级账户（数字越小优先级越高）
2. **同优先级内调度**：只有在同一优先级的账户之间才会应用调度策略
3. **分组隔离**：每个分组独立管理自己的调度策略

### LRU策略（默认）
- **适用范围**：在最高优先级组内
- **选择逻辑**：优先选择最久未使用的账户
- **特点**：
  - ✅ 支持会话粘性（同一会话使用同一账户）
  - ✅ 自然负载均衡
  - ✅ 适合长连接场景

### 轮询策略（Round-Robin）
- **适用范围**：在最高优先级组内
- **选择逻辑**：按固定顺序循环选择
- **特点**：
  - ❌ 不支持会话粘性
  - ✅ 严格均等分配
  - ✅ 适合短连接场景

## 示例场景

### 场景1：混合优先级账户
```
分组中有：
- 账户A (优先级:10)
- 账户B (优先级:10)
- 账户C (优先级:10)
- 账户D (优先级:50)
- 账户E (优先级:50)

轮询策略结果：
只在A、B、C之间轮询，永远不会选择D、E

LRU策略结果：
只在A、B、C之间选择最久未使用的，永远不会选择D、E
```

### 场景2：同优先级账户
```
分组中有：
- 账户A (优先级:10)
- 账户B (优先级:10)
- 账户C (优先级:10)

轮询策略结果：
A → B → C → A → B → C → ...

LRU策略结果：
根据最后使用时间动态选择
```

### 场景3：优先级变化
```
初始状态：
- 账户A (优先级:50) - 活跃
- 账户B (优先级:50) - 活跃
- 账户C (优先级:10) - 不可用

当C恢复可用后：
立即切换到使用账户C，不再使用A、B
```

## 配置建议

### 使用LRU策略的场景
- 需要会话保持的应用
- 长连接服务
- 状态相关的操作

### 使用轮询策略的场景
- 无状态的API调用
- 需要严格均衡负载
- 测试账户限额

## 注意事项

1. **优先级设置**：合理设置账户优先级，避免所有账户都设置为相同优先级
2. **策略切换**：策略可以随时切换，立即生效
3. **索引管理**：每个优先级组维护独立的轮询索引
4. **降级机制**：当高优先级账户全部不可用时，自动降级到低优先级账户